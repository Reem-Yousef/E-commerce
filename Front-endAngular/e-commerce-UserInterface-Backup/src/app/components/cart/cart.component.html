<div class="cart-container">
  <h1 class="cart-title">Your Cart</h1>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Loading your cart...</p>
  </div>

  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadCart()" class="retry-btn">Try Again</button>
  </div>

  <div *ngIf="!loading && !error && (!cart || !cart.items || cart.items.length === 0)" class="empty-cart">
    <div class="empty-cart-icon">ðŸ›’</div>
    <h2>Your cart is empty</h2>
    <p>Looks like you haven't added anything to your cart yet.</p>
    <button class="shop-now-btn" (click)="continueShopping()">
      Start Shopping
    </button>
  </div>

  <div *ngIf="!loading && !error && cart && cart.items && cart.items.length > 0" class="cart-content">
    
    <div class="cart-table">
      <div class="cart-table-header">
        <div class="header-product">Product</div>
        <div class="header-price">Price</div>
        <div class="header-quantity">Quantity</div>
        <div class="header-subtotal">Subtotal</div>
        <div class="header-actions"></div>
      </div>

      <div *ngFor="let item of cart.items; trackBy: trackByProductId" class="cart-row">
        <div class="product-cell">
          <button class="remove-btn" 
                  (click)="showRemoveConfirmation(item.product._id)"
                  title="Remove item">
            âœ•
          </button>
          <div class="product-image">
            <img [src]="getProductImage(item.product)" 
                 [alt]="item.product.title || item.product.name"
                 (error)="handleImageError($event)">
          </div>
          <div class="product-info">
            <div class="product-name">{{ item.product.name || item.product.title }}</div>
            <div class="mobile-price">${{ item.product.price.toFixed(2) }}</div>
          </div>
        </div>
        
        <div class="price-cell">
          ${{ item.product.price.toFixed(2) }}
        </div>
        
        <div class="quantity-cell">
          <input type="number" 
                 [(ngModel)]="item.quantity"
                 (ngModelChange)="onQuantityChange(item.product._id, item.quantity)"
                 min="1"
                 class="quantity-input">
        </div>
        
        <div class="subtotal-cell">
          ${{ getItemSubtotal(item).toFixed(2) }}
        </div>
        
        <div class="actions-cell">
        </div>
      </div>
    </div>

    <div class="cart-bottom">
      <div class="cart-actions">
        <button class="update-cart-btn" 
                (click)="updateCart()"
                [disabled]="!hasChanges">
          Update cart
        </button>
      </div>

      <div class="cart-totals">
        <h3>Cart totals</h3>
        <div class="totals-content">
          <div class="totals-row">
            <span class="totals-label">Subtotal</span>
            <span class="totals-value">${{ subtotal.toFixed(2) }}</span>
          </div>
          <div class="totals-row total-row">
            <span class="totals-label">Total</span>
            <span class="totals-value">${{ total.toFixed(2) }}</span>
          </div>
          <button class="checkout-btn" (click)="proceedToCheckout()">
            Proceed to checkout
          </button>
          <button class="clear-cart-btn" (click)="showClearCartConfirmation()">
            Clear Cart
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showConfirmationPopup" class="confirmation-overlay">
  <div class="confirmation-popup">
    <h3>{{ confirmationTitle }}</h3>
    <p>{{ confirmationMessage }}</p>
    <div class="popup-buttons">
      <button class="confirm-btn" (click)="confirmAction()">Yes</button>
      <button class="cancel-btn" (click)="cancelAction()">No</button>
    </div>
  </div>
</div>